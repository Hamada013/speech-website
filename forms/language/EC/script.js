// قائمة المهارات الـ65 موزعة حسب المجموعات العمرية
const skillGroups = [
  {
    label: "العمر 0:0-0:2",
    items: [
      {
        number: 1,
        text: "وجود منعكس المص والبلع",
        instruction: "زجاجة رضاعة بحلمة أو لهاية يقدّمها المُعتني\nالتقييم : يُظهر تسلسلاً منسقًا بين المصّ والبلع؛ دون سعال أو اختناق أو سكب"
      },
      {
        number: 2,
        text: "يُصدر أصواتًا من الحنجرة",
        instruction: "ضع الطفل مستلقياً على ظهره وتحدث إليه.\nالتقييم : يُصدر أصواتًا رخوة، حنجريّة، غَرغَرية"
      },
      {
        number: 3,
        text: "يُغيّر نغمة أو مدة أو شدة البكاء",
        instruction: "هل يبكي طفلك أحيانًا بقوة وأحيانًا برقة؟\nالتقييم : يُصدر أصواتًا أو يبكي مع تنوّع في النغمة أو المدة أو الشدة"
      },
    ]
  },
  {
    label: "العمر 0:3-0:5",
    items: [
      {
        number: 4,
        text: "يستجيب للمتحدث بالابتسام",
        instruction: "هل يبتسم طفلك للأشخاص عندما يتحدثون إليه؟\nالتقييم : يبتسم استجابةً لاقتراب المتحدث منه أو حمله أو التحدث إليه"
      },
      {
        number: 5,
        text: "يُصدر أصواتًا تُعبّر عن المتعة والانزعاج",
        instruction: "هل يصدر طفلك أصواتًا عندما يكون سعيدًا \nومرتاحًا تختلف عن الأصوات التي يصدرها عندما يكون متعبًا أو منزعجًا أو غير سعيد؟\nالتقييم : يُصدر صوتين صحيحين (واحد للتعبير عن المتعة وآخر للتعبير عن الانزعاج)"
      },
      {
        number: 6,
        text: "يُصدر أصواتًا عند التحدث إليه، مع تحريك الذراعين والساقين أثناء إصدار الأصوات",
        instruction: "هل يصدر طفلك أصواتًا ويحرك ذراعيه ورجليه عندما يتحدث إليه أحدهم؟\nالتقييم :  تُرافق الأصوات حركات لا إرادية مثل خفق الذراعين أو تحريك الساقين"
      },
    ]
  },
  {
    label: "العمر 0:6-0:8",
    items: [
      {
        number: 7,
        text: "يضع الأشياء في فمه",
        instruction: "يُعبّر عن الرفض بالإشارة أو الصوت\nأمثلة على سلوكيات الاعتراض\nالتمدد نحو الشيء، دفع الشخص بعيدًا، هز الرأس بمعنى لا\nتحريك الرأس أو الجسم بعيدًا عن الوصي، الإمساك باللعبة بإحكام،البكاء\nالتقييم : يظهر الطفل سلوك اعتراض واحد على الأقل أو يصدر صوت اعتراض"
      },
      {
        number: 8,
        text: "يُحاول تقليد تعبيرات الوجه والحركات",
        instruction: "هل يحرك طفلك شفتيه أو لسانه عندما تصنع وجوهًا مضحكة أو تحرك شفتيك ولسانك؟\nالتقييم: يُحاول تحريك وجهه أو لسانه استجابةً لتعبيرات وحركات وجه المُعتني."
      },
      {
        number: 9,
        text: "يُصدر صوتين مختلفين من أصوات الصوامت",
        instruction: "هل يصدر طفلك أصواتًا مختلفة مثل /ب/ و /م/؟\nالتقييم: يُنتج صوتين مختلفين واضحين من أصوات الصامتة."
      },
      {
        number: 10,
        text: "يُصدر صوتين مختلفين من أصوات الصوائت",
        instruction: "هل يصدر طفلك أصواتًا مختلفة مثل /ا/ و /و/؟\nالتقييم: يُنتج صوتين مختلفين واضحين من أصوات الصوائت."
      },  
    ]
  },
  {
    label: "العمر 0:9-0:11",
    items: [
      {
        number: 11,
        text: "يدمج بين الأصوات",
        instruction: "هل يصدر طفلك صوتين معًا، مثل \"با\" أو \"با\"؟\nالتقييم: يُصدر تركيبة صوتية أو مقطعًا لفظيًا (V-V, C-V, or V-C)\nأمثلة على استجابات صحيحة:\n- متحرك-متحرك (V-V): آه-إي، أو-أوه\n- حرف ساكن-حرف متحرك (C-V): با، ما، دا، دو، تي\n- حرف متحرك-حرف ساكن (V-C): آخ، أب، أم\nأمثلة على استجابات غير صحيحة:\n- تكرار الحروف الساكنة فقط: ب-ب-ب-ب (مثل إصدار صوت فرقعة الشفاه)\n- إطالة الصوت المتحرك: آآآآآه\n- إطالة الصوت الساكن: م-م-م-م"
      },
      {
        number: 12,
        text: "يسعى لجذب انتباه الآخرين",
        instruction: "هل يحاول طفلك لفت انتباهك؟\nالتقييم: الطفل يبذل جهدًا لجذب أو الحفاظ على الانتباه."
      },
      {
        number: 13,
        text: "يلعب ألعابًا بسيطة مع شخص آخر مع استخدام التواصل البصري المناسب",
        instruction: "شارك الطفل في نشاط لعب تفاعلي مثل وضع الأشياء داخل الصندوق وخارجه\nالتقييم: يشارك في اللعب مع شخص آخر مع الحفاظ على التواصل البصري المناسب\nأمثلة على استجابات صحيحة:\n- الطفل يلعب (peek-a-boo) مع استخدام التواصل البصري المناسب."
      }
    ]
  },
  {
    label: "1:5-1:0 العمر",
    items: [
      {
        number: 14,
        text: "يستخدم إيماءة تمثيلية (رمزية)",
        instruction: "هل يلوح طفلك بيده ليقول وداعًا (باي-باي)؟\nهل يصفق طفلك بيديه ليُظهر أنه سعيد أو فخور بشيء فعله، مثل رمي الكرة؟\nالتقييم: يستخدم إيماءة رمزية واحدة.\n(مثال: يلوّح للوداع، يصفق، يحرك جسده)"
      },
      {
        number: 15,
        text: "يُصدر الطفل مقاطع صوتية مكونة من مقطعين",
        instruction: "العب مع الطفل لاستثارة إنتاج تركيبات مكونة من مقطعين.\nإذا أظهر الطفل اهتمامًا بالفقاعات، انفخ الفقاعات.\nقل تراكيب من مقطعين مع انفجار كل فقاعة.\nالتقييم:\nيُصدر مقطعًا مكونًا من مقطعين (مثل: ماما، بابا)."
      },
      {
        number: 16,
        text: "يتبادل الأدوار الصوتية عدة مرات",
        instruction: "عندما تقلد صوتًا يصدره طفلك، هل يعيد الطفل الصوت الذي قمت به؟\nهل يتبادل معك الأدوار صوتيًا مرتين أو ثلاث مرات؟\n\nالتقييم:\nأخذ الطفل على الأقل دورتين للتواصل الصوتي ردًا على تقليد الوصي لأصوات الطفل."
      },
      {
        number: 17,
        text: "يُنتج سلاسل صوتية (مقطعين إلى ثلاثة) بإيقاع يشبه كلام الكبار",
        instruction: "المواد: ألعاب وأشياء أبدى الطفل اهتمامًا بها مسبقًا\nالتقييم: يُنتج سلسلة مكونة من مقطعين إلى ثلاثة مقاطع بصوتية وإيقاع مشابه لكلام الكبار\nحرف ساكن - حرف متحرك (C-V) (لا)\nحرف ساكن - حرف متحرك - حرف ساكن (C-V-C) (مين)\nحرف ساكن - حرف متحرك - حرف ساكن - حرف متحرك (C-V-C-V) (بابا)\nأنواع أخرى"
      },
      {
        number: 18,
        text: "يُصدر خمس آصوات مختلفين من الاصوات الصامتة (?  b d m n )",
        instruction: "التقييم: يصدر الطفل خمس أصوات ساكنة مختلفة"
      },
      {
        number: 19,
        text: "يستخدم كلمة واحدة على الأقل",
        instruction: "المواد:\nألعاب وأشياء أبدى الطفل اهتمامًا بها مسبقًا.\n\nالتقييم:\nيُظهر استخدامًا ذا معنى لكلمة واحدة.\nلكي تُعتبر الكلمة ذات معنى، يجب أن تُستخدم تركيبة الصوت ككلمة بشكل متكرر.\nويجب أن تكون في سياق تواصلي مناسب.\nلا يشترط أن يكون النطق دقيقًا أو مطابقًا للكلمة."
      }
    ]
  },
  {
    label: "العمر 1:6-1:11",
    items: [
      {
        number: 20,
        text: "يستخدم الإيماءات والصوتيات لطلب الأشياء",
        instruction: "ضع اثنين أو ثلاثة أشياء بالقرب من الطفل ولكن بعيدًا عن متناوله.\nقل: \"انظر إلى هذه الأشياء\".\nراقب الطفل لترى إذا كان يشير إلى الشيء أو يحاول الوصول إليه ويصدر صوتًا لطلبه.\n\nالتقييم:\nيُظهر حالة يستخدم فيها الإيماءة والصوت لطلب شيء.\n\nأمثلة على الإجابات غير الصحيحة:\n- الطفل يشير أو يستخدم إيماءة بدون أصوات.\n- الطفل يصدر أصواتًا (مثل البكاء) بدون أن يشير أو يستخدم إيماءة لما يريد.\n- الطفل يصل إلى الشيء ويصدر صوتًا."
      },
      {
        number: 21,
        text: "يُشارك في نشاط لعب روتيني مع شخص آخر لمدة دقيقة واحدة على الأقل، مع الحفاظ على تواصل بصري مناسب",
        instruction: "المواد:\nساعة توقيت أو ساعة عقارب.\n\nالتقييم:\nيُشارك بانتباه ويحافظ على تواصل بصري لمدة دقيقة واحدة."
      },
      {
        number: 22,
        text: "يمد اللعبة أو يشير إلى شيء ليُظهره للآخرين",
        instruction: "هل يشير طفلك إلى الألعاب أو الأشياء الأخرى ليُظهرها لك؟\n\nضع الأشياء في متناول الطفل.\nاطلب من الوصي أن يُظهر للطفل أحد الأشياء.\nراقب إذا كان الطفل يشير إلى شيء آخر أو يُعطي شيئًا للوصي كما لو كان يُريه إياه.\n\nالتقييم:\nيجذب الطفل الانتباه إلى شيء ما عن طريق الإشارة أو العرض."
      },
      {
        number: 23,
        text: "يستخدم خمس كلمات على الأقل",
        instruction: "أثناء اللعب مع الطفل، أشر إلى الأشياء واسأله: \"ما هذا؟\"\n\nالكلمات التي نطقها الطفل:\n\nالتقييم:\nيُنتج خمس كلمات أو أكثر."
      }
    ]
  },
  {
    label: "العمر 2:0-2:5",
    items: [
      {
        number: 24,
        text: "يبدأ بلعبة تبادل الأدوار أو روتين اجتماعي",
        instruction: "اسأل الوصي إذا كان الطفل يلعب لعبة أو لديه روتين لعب باستخدام كرة، بطانية، أو دبدوب في المنزل.\n\nإذا كان الأمر كذلك، اطلب من الوصي اختيار واحدة وبدء اللعب بها.\n\nالتقييم:\nوجود مثال واحد على نشاط يبدأه الطفل معك أو مع الوصي أو شخص آخر."
      },
      {
        number: 25,
        text: "يستخدم الكلمات لأداء وظائف برغماتية متعددة",
        instruction: "التعليمات:\n\nضع وجبة خفيفة مقدمة من الوصي أو لعبة صغيرة داخل كيس بلاستيكي شفاف وأغلقه. قدم الكيس للطفل وانتظر لترى ما إذا كان يستخدم الكلمات ليطلب منك فتح الكيس. اختيارياً، قم بتشغيل لعبة اللف، وعندما تتوقف، انتظر لترى ما إذا كان الطفل يستخدم الكلمات ليطلب منك إعادة لف اللعبة.\n\nأمثلة تقريبية على الوظائف البرغماتية:\n- \"أعطني\" (يطلب أفعالاً أو أشياء)\n- \"كرة\" (يذكر أسماء أفعال أو أشياء)\n- \"مزيد\" (يطلب التكرار)\n- \"ساعدني\" (يطلب المساعدة)\n- يهز/يومئ برأسه (يجيب عن أسئلة بنعم/لا)\n- \"ماما!\" (يستخدم كلمة لجذب الانتباه)\n\nالتقييم:\n- يستخدم الكلمات للتعبير عن خمس وظائف برغماتية مختلفة\n\nملاحظة:\nيتم تقييم الوظيفة البرغماتية بغض النظر عن دقة النطق أو اكتمال الكلمة."
      }
    ]
  },
  {
    label: "العمر 2:6-2:11",
    items: [
      {
        number: 26,
        text: "يستخدم الكلمات أكثر من الإيماءات للتواصل",
        instruction: "سؤال مراقبة:\nعندما يرغب طفلك في شيء ما، كيف يعبر عن ذلك؟ هل يستخدم الكلمات أكثر من الإشارات مثل الإشارة، محاولة الوصول إلى الشيء، أو سحب الملابس؟\n\nخيارات الإجابة:\na. لا يستخدم لا كلمات ولا إيماءات\nb. يستخدم الإيماءات فقط\nc. يستخدم الإيماءات أكثر من الكلمات في التواصل\nd. يستخدم الإيماءات والكلمات بنفس المعدل\ne. يستخدم الكلمات أكثر من الإيماءات في التواصل\n\nالتقييم:\nيستخدم الكلمات أكثر من الإيماءات في التواصل (اختيار e)"
      },
      {
        number: 27,
        text: "يُسمي أشياء في الصور",
        instruction: "التعليمات:\n\nأشر إلى كل صورة وقل: \"انظر إلى هذه الصورة. ما هذا؟\"\n\nقائمة الصور:\n- كرة\n- طفل\n- طائر\n- بسكويت\n- حذاء\n- كلب / جرو\n- بالون\n- ملعقة\n- تفاحة\n- قطة / هرة\n\nالتقييم:\n- يُسمي الطفل خمس صور بشكل صحيح\n\nملاحظة:\nيتم قبول أي نطق معتاد للطفل للإشارة إلى الشيء (مثلاً: مياو للقطة، عوعو للكلب) ولا يُشترط النطق الكامل"
      }
    ]
  },
  {
    label: "العمر 3:0 - 3:5",
    items: [
      {
        number: 28,
        text: "يستخدم تراكيب لفظية مختلفة",
        instruction: "التعليمات:\n\n1. تركيب: اسم/ضمير + فعل\n(مثل: noun/pronoun + verb)\nالوصف: تركيب يتكون من اسم أو ضمير يليها فعل، يشير إلى من يفعل الفعل وما هو الفعل\n\nصحيح:\n- السيارة تمشي\n- أنت تفتح الباب\nغير صحيح:\n- سيارة (اسم فقط)\n- أفتح (فعل فقط)\n\n2. تركيب: فعل + ضمير/اسم\n(verb + noun/pronoun)\nالوصف: الفعل يأتي أولًا ثم الضمير أو الاسم الذي يتم عليه الفعل\n\nصحيح:\n- أطعم الكلب\n- أمسكني\nغير صحيح:\n- أكل (دون مفعول به)\n- أمسَك (دون ذكر الضمير أو الاسم)\n\n3. تركيب: اسم/ضمير + فعل + مكان\n(noun/pronoun + verb + location)\nالوصف: الجملة تحتوي على فاعل وفعل مع تحديد مكان حدوث الفعل\n\nصحيح:\n- الطفل يجلس هنا\n- نلعب في الحديقة\nغير صحيح:\n- الولد البيت في يلعب (ترتيب الكلمات غير سليم)\n- البنت (غير مكتملة)\n\n4. تركيب: اسم/ضمير + فعل + صفة (وأحيانًا اسم إضافي)\n(noun/pronoun + verb + adjective [+ optional noun])\nالوصف: الجملة تصف حالة الفاعل أو شيء مرتبط به عبر صفة.\n\nصحيح:\n- الطفل متعب\n- القطة أكلت كثيرًا\nغير صحيح:\n- أسود جرو يلعب (ترتيب غير صحيح)\n- جرو يأكل أكثر (غير واضحة أو ناقصة)\n\n5. تراكيب الملكية أو الإضافة (مثل اسم + اسم)\npossession\n\nالوصف: تركيب يعبر عن الملكية أو العلاقة بين كلمتين\n\nصحيح:\n- كرة أبي\n- حقيبتي\nغير صحيح:\n- ماما عصير (ترتيب غير سليم جداً، والصحيح: عصير ماما)\n- حقيبة (غير مكتملة)\n\nفي المجمل: الجمل الصحيحة تحوي على فعل وفاعل على الأقل، والتراكيب تكون مرتبة بشكل طبيعي حسب قواعد اللغة العربية. أما الجمل غير الصحيحة فهي إما مفردات فقط، أو ترتيبها خاطئ، أو ناقصة.\n\nالتقييم: يُنتج الطفل ثلاث تراكيب لفظية مختلفة"
      },
      {
        number: 29,
        text: "ينتج جمل من ثلاثة أو أربعة كلمات في الكلام التلقائي",
        instruction: "التعليمات:\n\nقدم للطفل عدة ألعاب وأشياء وضعها أمامه وشجعه على اللعب. خلال اللعب، تحدث مع الطفل.\n\nأمثلة تقريبية على التراكيب الشائعة في هذا العمر:\n- \"آنا اشرب عصير\" (ضمير + فعل + اسم)\n- \"الولد يلعب بالطابة\" (اسم + فعل + اسم)\n- \"ماما تقرأ قصة جديدة\" (اسم + فعل + اسم + صفة)\n- \"أين السيارة الحمراء؟\" (أداة استفهام + اسم + صفة)\n- \"البطة في الماء\" (اسم + حرف جر + اسم)\n\nالتقييم:\n- يُكوّن الطفل ثلاث جمل تحتوي على 4-3 كلمات لغوية مختلفة.\n\nملاحظة:\nعدد الكلمات في جملته هو الذي يتم حسابه بغض النظر عن نوع التركيب اللغوي."
      },
      {
        number: 30,
        text: "يستخدم صيغة فعل المضارع",
        instruction: "التعليمات:\n\nتدريب:\n- بنت تلعب\n- بنت تاكل\n- ولد ياكل\n- بنت تشرب\n- ولد يشرب\n- عيلة ياكلوا\n\nالتقييم: إجابتان صحيحتان"
      }
    ]
  },
  {
    label: "العمر 3:6 - 3:11",
    items: [
      {
        number: 31,
        text: "يستخدم صيغة جمع",
        instruction: "التعليمات:\n\nتدريب: تفاحات\n\nقائمة الكلمات:\n- سيارات\n- طابات\n- بالونات\n- شجرات\n- سمكات\n- طيارات\n\nالتقييم:\n- يجيب الطفل بأربع إجابات صحيحة\n\nملاحظة:\nيتم قبول أي صيغة جمع منطقية للكلمة حتى لو لم تكن الصيغة الفصحى الدقيقة"
      },
      {
        number: 32,
        text: "يستخدم أدوات الملكية",
        instruction: "التعليمات:\n\nتدريب: هي موزة الولد هي موزتو وهي موزتها\n\nأمثلة:\n- طابتها / طعامها\n- طابتو / طعامو\n- كلبو / قطتها\n- كلبها / قطتها\n\nالتقييم:\n- يجيب الطفل بثلاث إجابات صحيحة\n\nملاحظة:\nيتم قبول صيغ الملكية المستخدمة في اللهجة المحلية للطفل"
      },
      {
        number: 33,
        text: "يصف كيفية استخدام الشيء",
        instruction: "التعليمات:\n\nتمرين: انظر إلى هذه الصورة. هذا قلم رصاص. ماذا تفعل بالقلم الرصاص؟ (تكتب به، ترسم به)\n\nالأشياء المطلوبة:\n- فرشاية\n- ملعقة\n- سكين\n- منشفة\n- جرابات\n- طنجرة\n\nالتقييم:\n- يصف الطفل استخدام أربعة أشياء بشكل صحيح\n\nملاحظة:\nيتم قبول أي وصف منطقي لاستخدام الشيء حتى لو لم يكن الاستخدام الأساسي له"
      }
    ]
  },
  {
    label: "العمر 4:0-4:5",
    items: [
      {     
        number: 34,
        text: "يستخدم صيغة جمع تكسير",
        instruction: "التعليمات:\n\nتدريب: قطط\n\nقائمة الكلمات المفرد:\n- كلاب (كلب)\n- اصابع (إصبع)\n- موز (موزة)\n- الوان (لون)\n- عيون (عين)\n\nالتقييم:\n- يجيب الطفل بأربع إجابات صحيحة\n\nملاحظة:\nيتم قبول أي صيغة جمع تكسير مستخدمة في اللهجة المحكية حتى لو اختلفت عن الفصحى"
      },
      {
        number: 35,
        text: "ينتج صيغة المثنى",
        instruction: "التعليمات:\n\nتمرين: قلم قلمين\n\nأمثلة:\n- سيارتين\n- قلمين\n- تفاحتين\n- بابين\n\nالتقييم:\n- يجيب الطفل بثلاث إجابات صحيحة\n\nملاحظة:\nيتم قبول صيغ المثنى المستخدمة في اللهجة المحلية للطفل"
      },
      {
        number: 36,
        text: "يجيب عن الأسئلة بمنطق",
        instruction: "التعليمات:\n\nتمرين: ماذا تفعل عندما تشعر بالجوع؟ (تأكل)\n\nأسئلة:\n- ماذا تفعل إذا كانت يداك متسختين؟ (غسلهم)\n- ماذا تفعل عندما تشعر بالبرد؟ (البس)\n- ماذا تفعل عندما تشعر بالتعب؟ (نام)\n\nالتقييم:\n- يجيب الطفل بإجابتين صحيحتين\n\nملاحظة:\nيتم قبول أي إجابة منطقية حتى لو لم تكن الكلمة دقيقة"
      },
      {
        number: 37,
        text: "ينتج توافق الجنس",
        instruction: "التعليمات:\n\nأمثلة توافق الجنس:\n1. اسم مع فعل (ولد ياكل/بنت تاكل)\n2. اسم مع صفة (ولد طويل/بنت طويلة)\n3. صفة لون (قلم احمر/وردة صفرا)\n4. اسم اشارة مع اسم (هذا ولد/هي بنت)\n\nمجموعة 1:\n- ولد يشرب / بنت (تشرب)\n- ولد (يلعب) / بنت تلعب\n- ولد يكتب / بنت (تكتب)\n- ولد (يمشط) / بنت تمشط\n\nمجموعة 2:\n- فيل كبير / فارة صغيرة\n- دجاجة كبيرة / صوص (صغير)\n- زرافة طويلة / ولد (قصير)\n- زرافة طويلة / بنت (قصيرة)\n- عصفور احمر / سيارة (حمرا)\n- فليفلة صفرا / باص (اصفر)\n\nمجموعة 3:\n- هذا ولد / هي بنت\n- هذا ديك / (هي) دجاجة\n- هذا تور / (هي) بقرة\n- (هذا) باص / هي سيارة\n\nالتقييم:\n- يجيب الطفل بثلاث إجابات صحيحة في كل مجموعة\n\nملاحظة:\nيتم قبول الصيغ المستخدمة في اللهجة المحلية"
      },
      {
        number: 38,
        text: "ينتج توافق العدد مع الاسم",
        instruction: "التعليمات:\n\n1. عدد مع اسم اشارة\n   - هذه ولد / هدول اولاد\n   - هذه بنت / هدول بنات\n\n2. عدد مع جمع\n   - بالون واحد / خمس بالونات\n   - سمكة وحدة / ثلاث سمكات\n\nالتقييم:\n- يجيب الطفل بإجابة صحيحة لكل بند\n\nملاحظة:\nيتم قبول صيغ الجمع المستخدمة في اللهجة المحلية"
      }
    ]
  },
  {
    label: "العمر 4:6-4:11",
    items: [
      {
        number: 39,
        text: "يجيب عن أسئلة ماذا، أين، ومتى",
        instruction: "التعليمات:\n\nالجزء الآول:\n- شو عم يعمل الولد؟\n- وين الولاد؟\n- ايمت نام/فاق الولد؟\n\nالجزء الثاني:\n- ماذا أكلت في الإفطار؟\n- أين أكلت الإفطار؟\n- متى تنظف أسنانك؟\n- متى تذهب إلى النوم؟\n\nالتقييم:\nثلاث إجابات صحيحة من الجزء الثاني/ الجزء الآول تدريب"
      },
      {
        number: 40,
        text: "يستخدم زمن الفعل الماضي",
        instruction: "التعليمات:\n\nتمرين:\nولد يغسل / ولد غسل وخلص\n\nأمثلة:\n- غسلت\n- لبس\n- لبست\n\nالتقييم:\nإجابتان صحيحتان\n\nملاحظة:\nلا تعاقب إذا استخدم الطفل فعلًا غير الفعل المستهدف طالما أن زمن الفعل صحيح والمنطوق معقول"
      },
      {
        number: 41,
        text: "يكمل المقارنة والمشابهة",
        instruction: "التعليمات:\n\nتمرين: أرني يدك. انتظر حتى يفعل الطفل ذلك، ثم ضع يدك بجانب يد الطفل.\nقل: يدي كبيرة. يدك... (صغيرة)\n\n- أجلس على الكرسي؛ أنام في...\n- الخبز للأكل؛ الحليب لـ...\n- النملة صغيرة؛ الفيل...\n- التلج بارد؛ النار...\n- الليل مظلم؛ النهار...\n- السمك يسبح؛ الطائر...\n- الأسد قوي؛ الفأر...\n- الليمون حامض؛ السكر...\n- السيارة سريعة؛ السلحفاة...\n- الصيف حار؛ الشتاء...\n\nالتقييم: \nثماني إجابات صحيحة"
      }
    ]
  },
  {
    label: "العمر 5:0-5:11",
    items: [
      {
        number: 42,
        text: "يسمي حسب الوصف",
        instruction: "التعليمات:\n\nتمرين: ما هو الحيوان الذي يطارد الفئران وله شوارب؟ يصدر صوت مواء. (قط)\n\n- ما هي اللعبة الدائرية التي ترتد؟ تستخدمها للرمي والقبض عليها.\n- ماذا تستخدم عندما تنتهي من الاستحمام أو تخرج من الدش؟ تستخدمه لتجفيف نفسك.\n- ماذا تستخدم عندما تريد أن ترسم شيئًا؟ تأتي في علبة.\n\nالتقييم: إجابتان صحيحتان\n\nإضافي:\n- ما هو الشيء الذي يضيء في الليل ويراه الناس من بعيد؟\n- ما هو الشيء الذي تلبسه في قدميك عندما تخرج من المنزل؟\n- ما هو الشيء الذي تستخدمه لتقطيع الخيار والبندورة؟\n- ما هو الشيء الذي يخرج من الدجاجة ويأكله الناس؟\n- ما هو الشيء الذي يغطي جسمك عندما تنام في الليل؟"
      },
      {
        number: 43,
        text: "يجيب عن أسئلة تتعلق بأحداث افتراضية",
        instruction: "التعليمات:\nتمرين: ماذا تفعل إذا لم تستطع إيجاد حذائك في الصباح؟\n\n- ماذا تفعل إذا شعرت بالمرض؟\n- ماذا تفعل إذا سقطت؟\n- ماذا تفعل إذا أردت اللعب بلعبة صديقك؟\n\nالتقييم: إجابتان صحيحتان\n\nإضافي:\n- ماذا تفعل إذا جعت؟\n- ماذا تفعل إذا انكسرت لعبتك؟\n- ماذا تفعل إذا عطشت؟"
      },
      {
        number: 44,
        text: "يسمي فئات المفاهيم",
        instruction: "التعليمات:\nتمرين: استمع، كلب، قط، حصان، بقرة، ماعز. كل هذه حيوانات.\n\n- خبز، فاصوليا، تفاح، أرز. كل هذه...\n- ماء، حليب، عصير، صودا. كل هذه...\n- قميص، فستان، بنطلون، جوارب. كل هذه...\n\nالتقييم: إجابتان صحيحتان\n\nإضافي:\n- تفاح، موز، عنب، برتقال. كل هذه...\n- جزر، خيار، طماطم، بطاطس. كل هذه...\n- عصفور، بطة، نسر، حمامة. كل هذه...\n- كرة، دمية، مكعبات، سيارة لعبة. كل هذه...\n- أحمر، أزرق، أصفر، أخضر. كل هذه...\n- قطة، كلب، أرنب، هرة. كل هذه..."
      }
    ]
  },
  {
    label: "العمر 5:6-5:11",
    items: [
      {
        number: 45,
        text: "يجيب على أسئلة \"لماذا\" بتقديم سبب",
        instruction: "التعليمات:\n\nتمرين:\n- لماذا نلبس الأحذية؟\n- لماذا ننام؟\n- لماذا نأكل؟\n- لماذا نغسل أيدينا؟\n\nالتقييم:\nإجابتان صحيحتان\n\nملاحظة:\nيتم قبول أي إجابة منطقية توضح سببًا صحيحًا حتى لو لم تكن الصيغة اللغوية دقيقة"
      },
      {
        number: 46,
        text: "يكرر الجمل التي يسمعها",
        instruction: "التعليمات:\n\nتمرين:\nاستمع وقل ما أقول.\n\nالجمل المطلوبة:\n1. \"أنا أحب الشوكولاتة\"\n2. \"هل تعطيني شيئًا لأشرب؟\"\n3. \"الطفلة التي تغني هي أختي\"\n4. \"هل يمكن لأصدقائي القدوم لمشاهدة التلفاز؟\"\n5. \"عندما عاد من المدرسة، أكل سامي تفاحة\"\n\nالتقييم:\n- يكرر الطفل إجابتين صحيحتين\n\nملاحظة:\nيتم قبول التكرار مع وجود أخطاء طفيفة في النطق طالما ظلت الجمل مفهومة"
      }
    ]
  },
  {
    label: "العمر 6:0-6:11",
    items: [
      {
        number: 47,
        text: "يسرد القصة بتتابع منطقي",
        instruction: "التعليمات:\n\nتمرين:\n1. كان هناك أخوان يلعبان كرة السلة، وقال الأخ الأكبر، أنت لن تسجل أي سلة أبدًا!\n2. أخذ الأخ الأصغر الكرة ورمى بها عالياً قدر استطاعته.\n3. أوه! تعثر الأخ الأصغر وسقط، ولكن الكرة رغم ذلك دخلت السلة.\n\nقصة 2:\n1. كان يبحث عن دبه.\n2. \"ماما، هل تعرفين أين دبي؟\"\n3. وكان يبحث عن الدب في كل مكان.\n4. ماما وجدت الدب.\n\nالتقييم:\n- يصف الطفل جميع الصور بتتابع منطقي\n\nملاحظة:\nالتسلسل الصحيح للقصة هو ١-٢-٣-٤ أو ١-٣-٢-٤. لا يشترط أن تكون وصف كل صورة جملة كاملة أو صحيحة نحويًا للحصول على النقاط عن التسلسل."
      },
      {
        number: 48,
        text: "يسرد القصة باستخدام جمل صحيحة نحويًا",
        instruction: "التعليمات:\n\nتمرين:\n1. كان يبحث عن دبه.\n2. \"ماما، هل تعرفين أين دبي؟\"\n3. وكان يبحث عن الدب في كل مكان.\n4. ماما وجدت الدب.\n\nالتقييم:\n- يستخدم الطفل ثلاث جمل صحيحة نحويًا أو أكثر تصف الأفعال في الصور.\n\nملاحظة:\nيجب أن تكون كل جملة صحيحة نحويًا وأن تتوافق مع الفعل الظاهر في كل صورة من الصور. عند سرد الطفل للقصة، يجب أن يتضمن إشارات على الأقل للصورة الأولى."
      },
      {
        number: 49,
        text: "يصحح السخافة اللغوية (اللغة الدلالية)",
        instruction: "التعليمات:\n\nتمرين:\n1. انت ولد؟ (اذا كانت بنت)\n2. موزة لونها احمر؟\n3. القطة بتعمل عوو؟\n\nأمثلة أخرى:\n- الولد أكل سيارة كبيرة.\n- الفتاة تأكل معكرونة بحذاء.\n- الولد ينام على دراجة هوائية.\n\nالتقييم:\n- إجابتين صحيحتين\n\nملاحظة:\nلا يشترط أن يكون الرد صحيحًا نحويًا شرط أن يكون البناء الجديد مناسبًا دلاليًا."
      },
      {
        number: 50,
        text: "يعيد سرد قصة مع مقدمة",
        instruction: "التعليمات:\n\n1. الطفلان لديهما كلب اسمه لولو.\n2. آحمد ومايا شافوا لولو برا تحت المطر.\n3. الكلب يحتاج إلى منزل.\n4. لولو تبلل بالكامل تحت المطر.\n5. الطفلان سيصنعان منزلًا.\n\nالتقييم:\n- الطفل يقدم القصة/الشخصيات (بما في ذلك الكلب والأطفال) من الجزء الأول من القصة."
      },
      {
        number: 51,
        text: "يعيد سرد قصة بأربعة أحداث متسلسلة",
        instruction: "التعليمات:\n\nالتقييم:\n- الطفل يصف أربعة أحداث على الأقل من أجزاء القصة بترتيب صحيح\n- ينبغي أن يستخدم الطفل كلمات مثل \"ثم\" أو \"بعد ذلك\" أو \"لذا\".\n\nملاحظة:\nيجب ألا يكتفي الطفل بتسمية الفعل في كل صورة فقط."
      },
      {
        number: 52,
        text: "يعيد سرد قصة بخاتمة منطقية",
        instruction: "التعليمات:\n\n1. الآن عندما تمطر، لا يبتل لولو.\n2. لولو جاف ودافئ عندما تمطر الآن.\n3. النهاية.\n4. لولو سعيد.\n5. لولو نائم في منزله الصغير.\n\nالتقييم:\n- يجب أن تتضمن إعادة السرد خاتمة منطقية تشمل معلومات من الجزء الثامن من القصة.\n- لا يتضمن بوصف الفعل الأخير فقط دون تعليقات ختامية."
      },
      {
        number: 53,
        text: "يكمل أوجه الشبه",
        instruction: "التعليمات:\n\nتمرين:\n- فكر في شيء شديد السخونة. (الشمس/النار/الشمعة)\n\nأمثلة:\n1. إذا كان شيء ما شديد البرودة، بارد.\n2. إذا كان شيء ما حادًا جدًا،\n3. إذا كان شيء شيئًا أخضر جدًا،\n\nإضافي:\n4. إذا كان شيء ما كبيرًا جدًا،\n5. إذا كان شيء ما سريعًا جدًا،\n6. إذا كان شيء ما لينًا جدًا،\n\nالتقييم:\n- يجب أن يكون هناك إجابتان صحيحتان على الأقل"
      }
    ]
  },
  {
    label: "العمر 7:0 - 7:11",
    items: [
      {
        number: 54,
        text: "يصف أوجه التشابه",
        instruction: "التعليمات:\n\nتمرين:\n- شبه بين كرسي وكلب\n\nأمثلة:\n1. كيف يشبه الطائرة والطيور بعضهما البعض؟\n2. كيف يشبه الشمس والقمر بعضهما البعض؟\n3. كيف يشبه الحجر والطوبة بعضهما البعض؟\n4. كيف يشبه الحليب والعصير بعضهما البعض؟\n\nالتقييم:\n- ثلاث إجابات صحيحة منطقية\n\nملاحظة:\nلا يجب أن تكون الإجابة جملة كاملة أو صحيحة نحويًا للحصول على درجة صحيحة."
      },
      {
        number: 55,
        text: "ينتج صيغة المضارع المنصوب",
        instruction: "التعليمات:\n\nأمثلة:\n1. الطفل لا يريد أن يأكل. أمه تريد منه أن... (يأكل)\n2. هي لا ترغب في القفز. لا أعتقد أن... (تقفز)\n3. الطفل الطويل يصل إلى التفاحة. لا أعتقد أن هذا الطفل... (يحتاج مساعدة)\n4. هذا الطفل يرسم. ليس لديه ورقة. لا أعتقد أنه... (يستطيع الرسم)\n5. هذه الفتاة بحاجة إلى مساعدة. تريد من أمها أن... (تساعدها)\n\nمعلومات إضافية:\nأدوات نصب المضارع:\n- أَنْ (من أجل) = أريد أن ألعبَ\n- لِـ (من أجل) = درست لِأنجح\n- حَتَّى = تعبت حتى وصلت\n- لَنْ (نفي المستقبل) = لن أذهب\n- إِذَنْ (النتيجة) = إذن نذهب\n\nالتقييم:\n- ثلاث إجابات صحيحة\n\nملاحظة:\nيتم قبول أي فعل مضارع منصوب منطقي في السياق حتى لو لم يكن الفعل المتوقع، مع مراعاة استخدام أدوات النصب المناسبة"
      },
      {
        number: 56,
        text: "يشكل جملة من مفردات (صياغة جمل)",
        instruction: "التعليمات:\n\nتدريب ١:\n- دورك: \"الآن كوّن جملة باستخدام كلمتي 'كلب' و'قطة'.\"\n\nتدريب ٢:\n- دورك: \"الآن كوّن جملة باستخدام الكلمات: 'بسكويت'، 'أخوات'، و'كتير'.\"\n\nأمثلة أخرى:\n- ولد، بسكليت\n- المدرسة، الولد\n- بنت، ما، شافت\n\nالتقييم:\n- إجابتان صحيحتان\n\nملاحظة:\nيجب أن تكون الجملة التي يصوغها الطفل صحيحة من حيث المعنى والقواعد، وتحتوي على جميع الكلمات المستهدفة."
      },
      {
        number: 57,
        text: "ينتج مرادفات للكلمات",
        instruction: "التعليمات:\n\nأمثلة:\n- ولد غاضبًا: معصب\n- أعطيت أمي زهرة الجميلة: حلوة\n- كان علي يبدو غير سعيد: حزين\n- كان اللغز بسيطًا: سهل\n\nإضافي:\n- سلحفاة تمشي ببطء\n- ولد ذكي\n- بنت فرحانة\n\nالتقييم:\n- ثلاث إجابات صحيحة\n\nملاحظة:\nلا يلزم أن تكون الإجابات صحيحة نحويًا (مثل توافق الصفة مع الاسم) لمنح الدرجة."
      },
      {
        number: 58,
        text: "يستخدم مفاهيم كمية ( أكثر من )",
        instruction: "التعليمات:\n\nتمرين:\n- هاد الولد (اصغر من / اكبر من)\n\nأمثلة أخرى:\n- اكثر من / اقل من\n- اطول من / اقصر من\n\nالتقييم:\n- إجابتان صحيحتان"
      },
      {
        number: 59,
        text: "ينتج كلمة جديدة من كلمة تم حذف صوت منها (وعي فونولوجي)",
        instruction: "التعليمات:\n\nأمثلة:\n- باب = اب\n- بحر = بر\n- شمع = شم\n\nتدريبات:\n1. كلب = لب\n2. صبح = صح\n3. تمر = تم\n\nالتقييم:\n- إجابتان صحيحتان"
      },
      {
        number: 60,
        text: "ينتج كلمات تتناغم مع الكلمة التي يسمعها (وعي فونولوجي)",
        instruction: "التعليمات:\n\nأمثلة:\n- شم (سم/عم/فم/دم)\n- قلب (لعب/كلب/حلب/صلب)\n- تمر (نمر/زمر/حمر/جمر)\n\nتدريب:\n- قرد / فرد / ورد / برد / نرد\n\nالتقييم:\n- إجابتان صحيحتان"
      },
      {
        number: 61,
        text: "ينتج مفاهيم الزمن والتسلسل (متأخر، قبل)",
        instruction: "التعليمات:\n\nأمثلة:\n1. وصل هذا الولد إلى المدرسة مبكرًا. وصل هذا الولد إلى المدرسة... (متأخرًا، متأخر عن المدرسة، لاحقًا)\n2. فرشت الفتاتان أسنانهما في الصباح. فرشت هذه الفتاة أسنانها بعد أن ارتدت ملابسها للمدرسة، ولكن هذه الفتاة فرشت أسنانها... (قبل، قبل أن ترتدي ملابسها للمدرسة، قبل المدرسة)\n\nالتقييم:\n- إجابتان صحيحتان"
      }
    ]
  },
];


const responses = {};
const showInstructions = {};
const showImages = {};
const hideImageButtonFor = [
  1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,28,29,41,42,43,44,45,46,49,53,59,60,
];

const container = document.getElementById("skills-container");

// helper to generate id from label
function sanitizeLabelToId(label) {
  let cleaned = label.replace(/العمر\s*/i, "").trim();
  cleaned = cleaned.replace(/[:\s.]+/g, "-").replace(/[^\w\-]/g, "");
  return `age-${cleaned}`;
}

function createButton(text, className = "", onClick) {
  const btn = document.createElement("button");
  btn.type = "button";
  btn.textContent = text;
  btn.className = className;
  if (onClick) btn.addEventListener("click", onClick);
  return btn;
}

// render age navigation; uses skillGroups directly so tested detection reliable
function createAgeNavButtons() {
  const containerBtn = document.getElementById("age-nav-buttons");
  if (!containerBtn) return;
  containerBtn.innerHTML = "";

  skillGroups.forEach((group) => {
    const rawLabel = group.label || "";
    const displayLabel = rawLabel.replace(/العمر\s*/i, "").trim();
    const safeId = sanitizeLabelToId(rawLabel);
    // ensure group card has that id (used for scroll)
    const existingCard = document.getElementById(safeId);
    if (!existingCard) {
      // will be created later in renderSkills (but assign anyway if exists)
    }

    const btn = createButton(displayLabel, "age-jump-button", (e) => {
      e.preventDefault();
      const targetEl = document.getElementById(safeId);
      if (!targetEl) return;
      targetEl.scrollIntoView({ behavior: "smooth", block: "start" });
      targetEl.classList.add("highlight-temp");
      setTimeout(() => targetEl.classList.remove("highlight-temp"), 1200);
    });
    btn.setAttribute("data-target", safeId);

    // tested if any response exists in that group
    const tested = group.items.some(item => Boolean(responses[item.number]));
    if (tested) {
      btn.classList.add("tested");
    }

    containerBtn.appendChild(btn);
  });
}

function renderSkills() {
  container.innerHTML = "";

  skillGroups.forEach((group) => {
    const groupCard = document.createElement("div");
    groupCard.className = "group-card";
    groupCard.setAttribute("data-age", group.label);
    const generatedId = sanitizeLabelToId(group.label);
    groupCard.id = generatedId;

    const groupHeader = document.createElement("h3");
    groupHeader.className = "group-header";
    groupHeader.textContent = group.label;
    groupCard.appendChild(groupHeader);

    group.items.forEach((item) => {
      const skillItem = document.createElement("div");
      skillItem.className = "skill-item";

      const skillMain = document.createElement("div");
      skillMain.className = "skill-main";

      const skillText = document.createElement("p");
      skillText.className = "skill-text";
      skillText.textContent = `${item.number}. ${item.text}`;
      skillMain.appendChild(skillText);

      if (showInstructions[item.number]) {
        const instrText = document.createElement("pre");
        instrText.className = "instructions-text";
        instrText.textContent = item.instruction;
        skillMain.appendChild(instrText);
      }

      const skillControls = document.createElement("div");
      skillControls.className = "skill-controls";

      const controlButtonsLeft = document.createElement("div");
      controlButtonsLeft.className = "control-buttons-left";

      const instrBtn = createButton(
        showInstructions[item.number] ? "إخفاء التعليمات" : "تعليمات",
        "instructions-btn",
        () => {
          showInstructions[item.number] = !showInstructions[item.number];
          renderSkills();
          createAgeNavButtons();
        }
      );
      controlButtonsLeft.appendChild(instrBtn);

      if (!hideImageButtonFor.includes(item.number)) {
        const imageBtn = createButton(
          showImages[item.number] ? "إخفاء الصورة" : "عرض صورة",
          "skill-image-btn",
          () => {
            showImages[item.number] = !showImages[item.number];
            renderSkills();
            createAgeNavButtons();
          }
        );
        controlButtonsLeft.appendChild(imageBtn);
      }

      const noteBtn = createButton("ملاحظة", "note-button");
      controlButtonsLeft.appendChild(noteBtn);

      const noteInput = document.createElement("textarea");
      noteInput.className = "note-input hidden";
      noteInput.placeholder = "أدخل ملاحظة...";

      noteBtn.addEventListener("click", () => {
        noteInput.classList.toggle("hidden");
      });

      const answerButtonsDiv = document.createElement("div");
      answerButtonsDiv.className = "answer-buttons";

      ["يوجد", "لايوجد", "غير محدد"].forEach((option) => {
        const btn = createButton(option, "answer-button", () => {
          if (responses[item.number] === option) {
            delete responses[item.number];
          } else {
            responses[item.number] = option;
          }
          renderSkills();
          createAgeNavButtons();
        });
        if (responses[item.number] === option) {
          btn.classList.add("selected");
        }
        answerButtonsDiv.appendChild(btn);
      });

      skillControls.appendChild(controlButtonsLeft);
      skillControls.appendChild(answerButtonsDiv);

      skillItem.appendChild(skillMain);
      skillItem.appendChild(skillControls);
      skillItem.appendChild(noteInput);

      if (showImages[item.number]) {
        const img = document.createElement("img");
        img.src = `images/skill${item.number}.png`;
        img.alt = `صورة مهارة رقم ${item.number}`;
        img.className = "skill-image";
        skillItem.appendChild(img);
      }

      groupCard.appendChild(skillItem);
    });

    container.appendChild(groupCard);
  });

  createAgeNavButtons();
}

document.addEventListener("DOMContentLoaded", () => {
  renderSkills();
});

document.getElementById("export-btn").addEventListener("click", () => {
  const childName = document.getElementById("childName").value.trim() || "[غير مُدخل]";
  const parentName = document.getElementById("parentName").value.trim() || "[غير مُدخل]";
  const dob = document.getElementById("dob").value || "[غير مُدخل]";
  const surveyDate = document.getElementById("surveyDate").value || "[غير مُدخل]";
  const therapistName = (document.getElementById("therapistName")?.value.trim() || "[غير مُدخل]");

  const groupedAnswers = {
    يوجد: [],
    لايوجد: [],
    "غير محدد": [],
  };

  const testedGroups = new Set();

  skillGroups.forEach((group) => {
    group.items.forEach((item) => {
      const answer = responses[item.number];
      if (!answer) return;
      testedGroups.add(group.label);
      const skillElement = Array.from(document.querySelectorAll(".skill-item")).find((el) =>
        el.querySelector(".skill-text")?.textContent.startsWith(item.number + ".")
      );
      const noteText = skillElement
        ? skillElement.querySelector(".note-input")?.value.trim()
        : "";
      let entry = `${item.number}. ${item.text}`;
      if (noteText) entry += `\nملاحظة: ${noteText}`;
      groupedAnswers[answer].push(entry);
    });
  });

  let reportText = `===============================\n`;
  reportText += `مهارات الفهم السمعي \n`;
  reportText += `===============================\n\n`;
  reportText += `اسم الطفل: ${childName}\n`;
  reportText += `اسم ولي الأمر: ${parentName}\n`;
  reportText += `تاريخ الميلاد: ${dob}\n`;
  reportText += `تاريخ التقرير: ${surveyDate}\n\n`;
  reportText += `اسم الاختصاصي: ${therapistName}\n\n`;

  if (testedGroups.size) {
    reportText += `المجموعات التي تم اختبارها:\n`;
    Array.from(testedGroups).forEach((label) => {
      const display = label.replace(/العمر\s*/i, "").trim();
      reportText += `- ${display}\n`;
    });
    reportText += `\n`;
  }

  Object.entries(groupedAnswers).forEach(([key, items]) => {
    if (items.length) {
      reportText += `${key}:\n`;
      items.forEach((text) => {
        reportText += `${text}\n`;
      });
      reportText += `\n`;
    }
  });

  const reportWindow = window.open("", "_blank", "width=800,height=700,scrollbars=yes,resizable=yes");
  if (!reportWindow) {
    alert("يرجى السماح للنوافذ المنبثقة في المتصفح لعرض التقرير.");
    return;
  }
  const escapedReport = reportText.replace(/</g, "&lt;").replace(/>/g, "&gt;");
  const safeChildName = childName.replace(/["'<>]/g, "");
  reportWindow.document.write(`
    <html lang="ar" dir="rtl">
      <head>
        <title>مهارات التعبير التواصلي - تقرير</title>
        <meta charset="utf-8" />
        <style>
          body { font-family: "Noto Sans Arabic", sans-serif; margin: 20px; background: #f9f9f9; }
          pre { white-space: pre-wrap; word-wrap: break-word; background: #fff; border: 1px solid #ccc; padding: 15px; font-size: 16px; }
          button { margin-top: 15px; padding: 10px 15px; font-size: 16px; cursor: pointer; }
        </style>
      </head>
      <body>
        <h1>مهارات التعبير التواصلي - تقرير</h1>
        <pre id="report-text">${escapedReport}</pre>
        <button id="download-btn">تحميل التقرير</button>
        <script>
          document.getElementById("download-btn").addEventListener("click", () => {
            const text = document.getElementById("report-text").textContent;
            const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "تقرير_مهارات_التعبير التواصلي${safeChildName || 'child'}.txt";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          });
        </script>
      </body>
    </html>
  `);
  reportWindow.document.close();
});